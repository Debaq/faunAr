<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>FaunAR - Visor</title>
    <link rel="icon" type="image/png" href="assets/images/favicon.png">
    <link rel="stylesheet" href="css/viewer.css">

    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
</head>
<body>
    <div id="loading">
        <div class="spinner"></div>
        <h2>Cargando experiencia AR...</h2>
        <p id="loading-status">Iniciando</p>
        <button id="start-ar-btn" style="display: none; margin-top: 20px; padding: 15px 30px; font-size: 18px; background: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer;" onclick="manualStartAR()">Iniciar AR</button>
    </div>

    <button id="back-btn" onclick="window.location.href='index.html'">â† Volver</button>

    <!-- BotÃ³n para mostrar/ocultar info -->
    <button id="info-toggle-btn" onclick="toggleInfo()" style="position: fixed; top: 10px; right: 10px; background: rgba(0, 0, 0, 0.6); color: white; border: none; padding: 10px; border-radius: 50%; font-size: 18px; cursor: pointer; z-index: 300; width: 44px; height: 44px; backdrop-filter: blur(10px);">â„¹ï¸</button>

    <!-- BotÃ³n para modo 3D -->
    <button id="view-3d-btn" onclick="enable3DMode()" style="position: fixed; top: 60px; right: 10px; background: rgba(76, 175, 80, 0.8); color: white; border: none; padding: 10px 15px; border-radius: 8px; font-size: 14px; cursor: pointer; z-index: 300; backdrop-filter: blur(10px); font-weight: 600; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">ğŸ‘ï¸ Ver en 3D</button>

    <!-- BotÃ³n de control de audio -->
    <button id="audio-control-btn" onclick="toggleAudio()" style="position: fixed; top: 110px; right: 10px; background: rgba(33, 150, 243, 0.8); color: white; border: none; padding: 10px; border-radius: 50%; font-size: 18px; cursor: pointer; z-index: 300; width: 44px; height: 44px; backdrop-filter: blur(10px); display: none;">ğŸ”Š</button>

    <!-- Instrucciones de modo 3D -->
    <div id="controls-hint" style="position: fixed; bottom: 140px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.85); color: white; padding: 15px 25px; border-radius: 12px; font-size: 14px; z-index: 400; backdrop-filter: blur(10px); display: none; text-align: center; max-width: 90%;">
        <div style="font-weight: 600; margin-bottom: 8px;">Controles 3D</div>
        <div style="font-size: 12px; opacity: 0.9;">
            ğŸ‘† 1 dedo: Rotar<br>
            âœŒï¸ 2 dedos: Zoom y Mover<br>
            ğŸ“± Mueve tu dispositivo para ver alrededor
        </div>
    </div>

    <div id="info-panel">
        <button onclick="toggleInfo()" style="position: absolute; top: 10px; right: 10px; background: transparent; border: none; color: white; font-size: 20px; cursor: pointer;">âœ•</button>
        <h3 id="animal-name"></h3>
        <p id="animal-scientific"></p>
        <div id="animal-details"></div>
    </div>

    <div id="gps-status" style="display: none;">
        <p id="distance-text"></p>
        <p id="direction-text"></p>
    </div>

    <!-- Controles de cÃ¡mara tipo app mÃ³vil -->
    <div id="camera-controls">
        <button id="gallery-btn" onclick="openGallery()"></button>
        <button id="capture-btn" onclick="capturePhoto()"></button>
    </div>

    <!-- Flash de captura -->
    <div id="capture-flash"></div>

    <!-- Preview de foto capturada -->
    <div id="photo-preview">
        <img id="preview-image" src="" alt="Foto capturada">
        <div id="photo-preview-actions">
            <button id="download-btn" onclick="downloadPhoto()">Descargar</button>
            <button id="share-btn" onclick="sharePhoto()">Compartir</button>
            <button id="close-preview-btn" onclick="closePreview()">Cerrar</button>
        </div>
    </div>

    <!-- GalerÃ­a de fotos -->
    <div id="photo-gallery">
        <div id="photo-gallery-header">
            <h2>Mis Fotos AR</h2>
            <button onclick="closeGallery()" style="background: transparent; border: none; color: white; font-size: 24px; cursor: pointer;">âœ•</button>
        </div>
        <div id="photo-gallery-grid"></div>
    </div>

    <a-scene
        id="ar-scene"
        embedded
        color-space="sRGB"
        renderer="colorManagement: true, physicallyCorrectLights; alpha: true; preserveDrawingBuffer: true"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false">

        <a-entity light="type: ambient; intensity: 2.5"></a-entity>
        <a-entity light="type: directional; intensity: 1.5; castShadow: true" position="1 2 1"></a-entity>
        <a-entity light="type: point; intensity: 1" position="0 2 0"></a-entity>

        <a-camera id="camera" position="0 0 0" look-controls="enabled: false" wasd-controls="enabled: false"></a-camera>
    </a-scene>

    <script src="js/config-loader.js?v=4"></script>
    <script src="js/ar-engine.js?v=4"></script>
</body>
</html>
