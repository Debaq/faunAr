  ---
  DIARIO DE CAMPO - FaunAR

  Descripci√≥n General

  Sistema tipo "coleccionable" donde los usuarios descubren animales al escanear sus marcadores AR. Funciona como un Pok√©dex de fauna nativa chilena.

  Arquitectura del Sistema

  Archivos Modificados/Creados

  HTML (viewer.html)

  - L√≠nea 62-65: Bot√≥n de diario con badge de progreso
  - L√≠nea 93-113: Modal completo del diario (header + contenido)
  - Estructura de 2 columnas: mapa + grid de animales

  CSS (viewer.css)

  - L√≠nea 263-301: Estilos del bot√≥n y badge
  - L√≠nea 453-665: Estilos completos del modal
  - L√≠nea 639-650: Estilos espec√≠ficos para siluetas SVG
  - Sistema de filtros CSS para locked/unlocked (grayscale + brightness)
  - Responsive: mobile cambia a 1 columna

  JavaScript (ar-engine.js)

  - L√≠nea 1488-1512: Sistema de carga din√°mica de animales
  - L√≠nea 1518-1556: Funciones de unlock y guardado en localStorage
  - L√≠nea 1569-1627: Notificaci√≥n animada al descubrir
  - L√≠nea 1630-1700: Renderizado del diario con SVG
  - L√≠nea 481-483, 590-593: Integraci√≥n con eventos de marcador

  PHP (api/get-models.php)

  - Ya exist√≠a: Escanea models/ din√°micamente
  - Retorna lista de carpetas con config.json

  Config Loader (js/config-loader.js)

  - L√≠nea 14-33: Nueva funci√≥n getAvailableModels() que consulta PHP
  - L√≠nea 36-49: loadAll() ahora 100% din√°mico
  - Eliminado: Array hardcodeado de modelos

  Configs Actualizados

  Todos los config.json ahora tienen:
  {
    "id": "nombre-modelo",
    "silhouette": "silueta_nombre-modelo.svg",
    ...
  }

  Archivos modificados:
  - models/puma/config.json (l√≠nea 8)
  - models/huillin/config.json (l√≠nea 8)
  - models/pudu/config.json (l√≠nea 8)
  - models/zorrodedarwin/config.json (l√≠nea 2, 8) - tambi√©n corregido id
  - models/ranadedarwin/config.json (l√≠nea 2, 8) - tambi√©n corregido id
  - models/carpintero/config.json (l√≠nea 8)
  - models/chucao/config.json (l√≠nea 8)
  - models/martinpescador/config.json (l√≠nea 8)

  Siluetas SVG Creadas

  8 archivos SVG placeholder (reemplazar con dise√±os reales):
  models/puma/silueta_puma.svg
  models/huillin/silueta_huillin.svg
  models/pudu/silueta_pudu.svg
  models/zorrodedarwin/silueta_zorrodedarwin.svg
  models/carpintero/silueta_carpintero.svg
  models/chucao/silueta_chucao.svg ‚Üê Usuario lo edit√≥ con Inkscape
  models/martinpescador/silueta_martinpescador.svg
  models/ranadedarwin/silueta_ranadedarwin.svg

  Funcionamiento

  1. Carga Inicial

  // Al cargar p√°gina
  ConfigLoader.loadAll()
    ‚Üí PHP escanea models/
    ‚Üí Carga todos los config.json
    ‚Üí Extrae: id, name, scientificName, icon, silhouette
    ‚Üí Guarda en ALL_ANIMALS[]

  2. Desbloqueo de Animales

  // Cuando se detecta marcador (targetFound event)
  unlockAnimal(modelId)
    ‚Üí Verifica si ya est√° descubierto
    ‚Üí Guarda en localStorage: 'faunar_discovered_animals'
    ‚Üí Actualiza badge del bot√≥n
    ‚Üí Muestra notificaci√≥n animada (3 segundos)

  3. Visualizaci√≥n del Diario

  // Al abrir diario
  openFieldJournal()
    ‚Üí renderFieldJournal()
      ‚Üí Calcula progreso (X de Y descubiertos)
      ‚Üí Renderiza barra de progreso
      ‚Üí Crea grid de animales:
        - Locked: silueta oscura + üîí + "???"
        - Unlocked: silueta color + nombre + clickeable

  4. Sistema de Persistencia

  localStorage keys:
  - faunar_discovered_animals: Array de IDs descubiertos
  - faunar_photos: Fotos capturadas (ya exist√≠a)

  Ejemplo:
  ["puma", "huillin", "ranadedarwin"]

  Estados Visuales

  Animal Bloqueado

  .animal-item.locked {
    opacity: 0.4;
    cursor: default;
  }
  .animal-silhouette {
    filter: grayscale(100%) brightness(0.5);
  }

  Animal Desbloqueado

  .animal-item.unlocked {
    border-color: rgba(139, 69, 19, 0.8);
    background: rgba(80, 80, 80, 0.8);
  }
  .animal-silhouette {
    filter: grayscale(0%) brightness(1);
  }

  Badge de Progreso

  <span id="field-journal-badge">3</span>
  - Anima al cambiar (scale 1.3 ‚Üí 1)
  - Actualiza autom√°ticamente al desbloquear

  Mapa Est√°tico

  Archivo: assets/images/map-placeholder.svg

  SVG placeholder con:
  - Monta√±as
  - Lago/r√≠o
  - √Årboles
  - Marcador de ubicaci√≥n pulsante
  - Texto: "√Årea de Exploraci√≥n"

  Para personalizar: Reemplazar con foto real del lugar o mapa topogr√°fico.

  C√≥mo Agregar Nuevo Animal

  1. Crear estructura

  mkdir models/nuevo-animal

  2. Crear config.json

  {
    "id": "nuevo-animal",
    "name": "Nombre Com√∫n",
    "scientificName": "Nombre cient√≠fico",
    "icon": "ü¶ä",
    "silhouette": "silueta_nuevo-animal.svg",
    "arMode": "marker",
    ...
  }

  3. Crear silueta SVG

  # Archivo: models/nuevo-animal/silueta_nuevo-animal.svg
  # - ViewBox flexible (200x200 recomendado)
  # - Color por defecto en <g fill="#...">
  # - Forma simplificada y reconocible

  4. ¬°Listo!

  El sistema detecta autom√°ticamente el nuevo modelo v√≠a PHP.

  Mejoras Pendientes

  Funcionalidades

  - Click en animal desbloqueado ‚Üí modal con m√°s info (descripci√≥n, h√°bitat, etc.)
  - Animaci√≥n de "nuevo descubrimiento" m√°s elaborada
  - Sonido al desbloquear animal
  - Compartir progreso en redes sociales
  - Resetear progreso (bot√≥n de borrar localStorage)
  - Estad√≠sticas: tiempo, ubicaciones, etc.

  UX/UI

  - Reemplazar siluetas SVG placeholder con dise√±os profesionales
  - Mapa real del √°rea de exploraci√≥n
  - Indicadores visuales de "casi cerca" de desbloquear
  - Efecto de "volteo de carta" al desbloquear
  - Tutorial/onboarding primera vez

  T√©cnico

  - Cachear loadAll() en sessionStorage
  - Optimizar carga paralela de SVGs
  - Lazy loading de siluetas
  - Versioning de localStorage para migraciones
  - Analytics de animales m√°s populares

  Notas T√©cnicas

  Performance

  - SVGs cargan bajo demanda al abrir diario
  - localStorage sincr√≥nico pero peque√±o (<1KB)
  - PHP cacheable con headers apropiados

  Compatibilidad

  - SVG soportado en todos los navegadores modernos
  - localStorage universal
  - Fallback a emoji si SVG falla (onerror)

  Consideraciones

  - Sin conexi√≥n funciona: todo en localStorage
  - PHP necesario solo para descubrimiento inicial
  - Siluetas pueden ser editadas en Inkscape/Adobe Illustrator

  Referencias de C√≥digo

  Eventos Clave

  // ar-engine.js:481-483
  anchor.addEventListener('targetFound', () => {
    unlockAnimal(modelId);  // ‚Üê Desbloquea al detectar
  });

  Renderizado

  // ar-engine.js:1677-1685
  if (animal.silhouette) {
    const path = `models/${animal.id}/${animal.silhouette}`;
    iconHTML = `<img src="${path}" class="animal-silhouette">`;
  }

  Estilos Din√°micos

  /* viewer.css:644-650 */
  .animal-silhouette {
    filter: grayscale(100%) brightness(0.5);
    transition: filter 0.3s ease;
  }
  .animal-item.unlocked .animal-silhouette {
    filter: grayscale(0%) brightness(1);
  }

  ---
  √öltima actualizaci√≥n: 2025-12-17
  Versi√≥n: 1.0
  Estado: Funcional - Siluetas placeholder
